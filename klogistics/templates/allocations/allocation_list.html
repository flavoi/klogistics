{% extends "base.html" %}

{% block extrahead %}
<link rel='stylesheet' href="{{ STATIC_URL }}css/fullcalendar/fullcalendar.min.css">
<link rel='stylesheet' href="{{ STATIC_URL }}css/fullcalendar/scheduler.min.css">
<script src="{{ STATIC_URL }}js/fullcalendar/moment.min.js"></script>
<script src="{{ STATIC_URL }}js/fullcalendar/fullcalendar.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/fullcalendar/2.9.1/lang/it.js"></script>
<script src="{{ STATIC_URL }}js/fullcalendar/scheduler.min.js"></script>
<script>
    $(function() { // document ready

        $('#calendar').fullCalendar({
            schedulerLicenseKey: 'CC-Attribution-NonCommercial-NoDerivatives',
            defaultDate: '{{ season.start_date|date:"Y-m-d" }}',
            now: '{{ now }}',
            contentHeight: 'auto',
            editable: false, // enable draggable events
            header: {
                left: '',
                center: '',
                right: ''
            },
            defaultView: 'timelineFifteenDays',
            views: {
                timelineFifteenDays: {
                    type: 'timeline',
                    duration: { days: {{ season_duration }} }
                }
            },
            resourceLabelText: 'Persone',
            resourceAreaWidth: '20%',
            resources: {
                url: '{% url 'people:ppljson' %}',
                error: function() {
                    $('#script-warning').show();
                }
            },
            slotDuration: { 
                days:1,
            },
            events: {
                url: '{% url 'allocations:season-json' season.pk %}',
                error: function() {
                    $('#script-warning').show();
                }
            },
        });
    
    });
</script>
<script src="http://malsup.github.com/jquery.form.js"></script>
<script>
$('#myModal').on('show.bs.modal', function (event) {
    var modal = $(this)
    $.ajax({
        url: "{% url 'allocations:create' %}",
        context: document.body
    }).done(function(response) {
        modal.html(response);
    });
})
</script>
{% endblock extrahead %}

{% block title %}
  {{ season.name }}
{% endblock title %}

{% block heading %}
    {{ season.name|title }}: {{ season.start_date }} - {{ season.end_date }}
    <p>
        <a class="btn btn-default" data-toggle="modal" data-target="#myModal" href="{% url 'allocations:create' %}">
            Registra la tua logistica
        </a>
    </p>
{% endblock heading %}

{% block content %}
    <!-- Modal -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content" id="myModalContent">
        </div>
      </div>
    </div>
    
    <!-- Calendar -->
    <div id='calendar'></div>
{% endblock content %}